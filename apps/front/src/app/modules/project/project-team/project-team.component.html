<div class="bg-blue1 flex flex-col h-full">
  <div class="flex flex-grow flex-col mx-6 mb-6 mt-8 h-2">
    <div class="flex flex-row items-center justify-between h-11">
      <div
        data-cy="projectTeamTitle"
        class="flex font-semibold text-2xl text-gray1"
        >{{ pageTitle }}
      </div>

      <button
        data-cy="projectTeamInviteMemberButton"
        class="py-2 px-5 text-base text-white rounded font-medium focus:outline-none"
        type="submit"
        [ngClass]="{
          'bg-blue3': isAdmin === true,
          'bg-gray-400 cursor-default': isAdmin === false
        }"
        (click)="inviteMember()"
        [disabled]="isAdmin === false"
        >Invite Member</button
      >
    </div>

    <div class="flex-grow bg-white mt-6 mb-4 rounded shadow-lg overflow-auto">
      <div class="mx-5 mt-8 text-gray1">
        <table class="min-w-full divide-y divide-gray-500">
          <thead>
            <tr class="text-sm h-12">
              <th></th>
              <th class="text-left">Name</th>
              <th class="text-left">Email</th>
              <th class="text-left">Alias</th>
              <th class="text-left">Access Roles</th>
              <th class="text-center">Project Admin</th>
              <th class="text-center">Files Editor</th>
              <th class="text-center">Explorer</th>
              <th></th>
            </tr>
          </thead>

          <tbody class="divide-y divide-gray-300">
            <tr
              *ngFor="
                let member of members
                  | paginate
                    : {
                        id: 'members',
                        itemsPerPage: perPage,
                        currentPage: currentPage,
                        totalItems: total
                      };
                let i = index
              "
              class="h-16"
            >
              <td class="w-24">
                <div class="flex">
                  <button
                    class="ml-5 h-10 w-10 rounded-full bg-blue-200 text-base tracking-wider focus:outline-none"
                    [ngClass]="{
                      'cursor-default': !member.avatarSmall
                    }"
                    (click)="
                      showPhoto(
                        member.memberId,
                        member.firstName,
                        member.lastName,
                        member.alias
                      )
                    "
                    [disabled]="!member.avatarSmall"
                  >
                    <m-avatar
                      [avatar]="member.avatarSmall"
                      [initials]="member.initials"
                    ></m-avatar>
                  </button>
                </div>
              </td>

              <td class="w-64 text-base">{{ member.fullName }}</td>

              <td data-cy="projectTeamMemberEmailData" class="w-64 text-base">
                {{ member.email }}
              </td>

              <td class="w-48 text-base">{{ member.alias }}</td>

              <td class="w-48">
                <div class="flex flex-row items-center">
                  <button
                    data-cy="projectTeamAddRoleButton"
                    class="flex items-center justify-center h-8 w-8 rounded focus:outline-none"
                    [ngClass]="{
                      'text-gray-400 cursor-default': isAdmin === false,
                      'text-blue3 hover:bg-blue2': isAdmin === true
                    }"
                    (click)="addRole(member, i)"
                    [disabled]="isAdmin === false"
                  >
                    <div>
                      <m-add-icon></m-add-icon>
                    </div>
                  </button>
                  <div class="flex flex-col my-3 ml-2">
                    <div *ngFor="let role of member.roles; let n = index">
                      <div class="flex flex-row items-center text-base">
                        <div>{{ role }} </div>
                        <button
                          data-cy="projectTeamRemoveRoleButton"
                          class="flex items-center justify-center h-8 w-8 ml-2 rounded focus:outline-none"
                          [ngClass]="{
                            'text-gray-400 cursor-default': isAdmin === false,
                            'text-gray1 hover:bg-blue2': isAdmin === true
                          }"
                          (click)="removeRole(member, i, n)"
                          [disabled]="isAdmin === false"
                        >
                          <div>
                            <m-delete-icon></m-delete-icon>
                          </div>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </td>

              <td>
                <div class="flex justify-center">
                  <button
                    data-cy="projectTeamIsAdminButton"
                    class="flex items-center justify-center h-5 w-5 border-2 text-white rounded focus:outline-none"
                    [ngClass]="{
                      'bg-blue3 ': member.isAdmin === true && isAdmin === true,
                      'bg-gray-400 cursor-default':
                        member.isAdmin === true && isAdmin === false,
                      'border-blue3': isAdmin === true,
                      'border-gray-400 cursor-default': isAdmin === false
                    }"
                    (click)="isAdminChange($event, i)"
                    [disabled]="isAdmin === false"
                  >
                    <m-check-icon *ngIf="member.isAdmin"></m-check-icon>
                  </button>
                </div>
              </td>

              <td>
                <div class="flex justify-center">
                  <button
                    data-cy="projectTeamIsEditorButton"
                    class="flex items-center justify-center h-5 w-5 border-2 text-white rounded focus:outline-none"
                    [ngClass]="{
                      'bg-blue3 ': member.isEditor === true && isAdmin === true,
                      'bg-gray-400 cursor-default':
                        member.isEditor === true && isAdmin === false,
                      'border-blue3': isAdmin === true,
                      'border-gray-400 cursor-default': isAdmin === false
                    }"
                    (click)="isEditorChange($event, i)"
                    [disabled]="isAdmin === false"
                  >
                    <m-check-icon *ngIf="member.isEditor"></m-check-icon>
                  </button>
                </div>
              </td>

              <td>
                <div class="flex justify-center">
                  <button
                    data-cy="projectTeamIsExplorerButton"
                    class="flex items-center justify-center h-5 w-5 border-2 text-white rounded focus:outline-none"
                    [ngClass]="{
                      'bg-blue3 ':
                        member.isExplorer === true && isAdmin === true,
                      'bg-gray-400 cursor-default':
                        member.isExplorer === true && isAdmin === false,
                      'border-blue3': isAdmin === true,
                      'border-gray-400 cursor-default': isAdmin === false
                    }"
                    (click)="isExplorerChange($event, i)"
                    [disabled]="isAdmin === false"
                  >
                    <m-check-icon *ngIf="member.isExplorer"></m-check-icon>
                  </button>
                </div>
              </td>

              <td>
                <button
                  data-cy="projectTeamRemoveMemberButton"
                  class="h-9 w-9 rounded text-gray1 focus:outline-none"
                  [ngClass]="{
                    'cursor-default':
                      member.memberId === userId || isAdmin === false,
                    'hover:bg-blue2':
                      member.memberId !== userId && isAdmin !== false
                  }"
                  [disabled]="member.memberId === userId || isAdmin === false"
                  (click)="removeMember(member)"
                >
                  <div
                    class="flex justify-center"
                    [ngClass]="{
                      'text-gray-400 ':
                        member.memberId === userId || isAdmin === false
                    }"
                  >
                    <m-delete-icon></m-delete-icon>
                  </div>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <pagination-controls
      class="flex justify-center mt-3"
      (pageChange)="getMembers($event)"
      id="members"
    ></pagination-controls>
  </div>
</div>

<div *ngIf="userId$ | async"></div>
<div *ngIf="projectId$ | async"></div>
<div *ngIf="isAdmin$ | async"></div>
<div *ngIf="members$ | async"></div>
<div *ngIf="total$ | async"></div>
