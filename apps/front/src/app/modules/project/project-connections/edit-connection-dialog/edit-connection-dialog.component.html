<div class="bg-m0 flex-grow select-none flex-col overflow-y-auto p-9">
  <div
    data-cy="editConnectionDialogTitle"
    class="text-s2 mt-5 flex-grow text-left text-2xl font-semibold"
    >Edit Connection</div
  >

  <form
    class="flex w-80 flex-col text-base"
    [formGroup]="editConnectionForm"
    (ngSubmit)="save()"
  >
    <div class="mt-9 flex flex-row">
      <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Name</div>
      <div>
        {{ this.ref.data.connection.connectionId }}
      </div>
    </div>

    <div class="flex flex-row">
      <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Env</div>
      <div>
        {{ this.ref.data.connection.envId }}
      </div>
    </div>

    <div class="flex flex-row">
      <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Type</div>
      <div>
        {{ this.ref.data.connection.type }}
      </div>
    </div>

    <div
      *ngIf="
        [typeBigQuery, typeGoogleApi].indexOf(
          editConnectionForm.controls['type'].value
        ) > -1
      "
    >
      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold"
          >Service Account Credentials</div
        >

        <div class="flex flex-col">
          <textarea
            rows="7"
            data-cy="editConnectionDialogServiceAccountCredentialsInput"
            class="form-input border-s3 focus:border-m600 w-[400px] resize-none whitespace-nowrap rounded font-mono"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['serviceAccountCredentials']
                  .invalid &&
                editConnectionForm.controls['serviceAccountCredentials'].touched
            }"
            formControlName="serviceAccountCredentials"
            placeholder="JSON BigQuery Credentials"
          ></textarea>
          <m-validation
            [control]="editConnectionForm.controls['serviceAccountCredentials']"
          ></m-validation>
        </div>
      </div>
    </div>

    <div
      *ngIf="
        [typeApi, typeGoogleApi].indexOf(
          editConnectionForm.controls['type'].value
        ) > -1
      "
    >
      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Base URL</div>

        <div class="flex flex-col">
          <input
            *ngIf="
              [typeApi].indexOf(editConnectionForm.controls['type'].value) > -1
            "
            autocomplete="off"
            spellcheck="false"
            data-cy="editConnectionDialogBaseUrlGoogleApiInput"
            class="form-input border-s3 focus:border-m600 w-[400px] rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['baseUrl'].invalid &&
                editConnectionForm.controls['baseUrl'].touched
            }"
            formControlName="baseUrl"
            placeholder="https://example.com"
          />

          <input
            *ngIf="
              [typeGoogleApi].indexOf(
                editConnectionForm.controls['type'].value
              ) > -1
            "
            autocomplete="off"
            spellcheck="false"
            data-cy="editConnectionDialogBaseUrlApiInput"
            class="form-input border-s3 focus:border-m600 w-[400px] rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['baseUrl'].invalid &&
                editConnectionForm.controls['baseUrl'].touched
            }"
            formControlName="baseUrl"
            placeholder="https://analyticsdata.googleapis.com"
          />
          <m-validation
            [control]="editConnectionForm.controls['baseUrl']"
          ></m-validation>
        </div>
      </div>
    </div>

    <div
      *ngIf="
        [typeGoogleApi].indexOf(editConnectionForm.controls['type'].value) > -1
      "
    >
      <div class="mb-6 flex flex-row items-center">
        <div class="flex w-[200px] flex-shrink-0 font-semibold">Scopes</div>
      </div>

      <div formArrayName="scopes">
        <div class="flex flex-col">
          <div *ngFor="let scopes of getScopes().controls; let i = index">
            <div
              [formGroupName]="i"
              class="mb-6 flex w-[700px] flex-row items-center"
            >
              <button
                class="text-s500 flex h-9 w-9 flex-shrink-0 items-center justify-center rounded focus:outline-none"
                (click)="removeScope(i)"
              >
                <m-trash-icon></m-trash-icon>
              </button>

              <div class="ml-5 select-none">Scope</div>

              <input
                class="form-input border-s3 focus:border-m600 ml-5 w-full rounded"
                autocomplete="off"
                spellcheck="false"
                data-cy="editConnectionScope"
                formControlName="value"
                placeholder="https://www.googleapis.com/auth/analytics.readonly"
              />
            </div>
          </div>
        </div>
      </div>

      <button
        type="button"
        data-cy="editConnectionDialogAddScopeButton"
        class="border-s400 text-s500 hover:bg-s100 h-11 flex-shrink-0 rounded border px-4 text-base leading-3 shadow-sm focus:outline-none"
        (click)="addScope()"
        >Add Scope</button
      >
    </div>

    <div
      *ngIf="
        [typeApi, typeGoogleApi].indexOf(
          editConnectionForm.controls['type'].value
        ) > -1
      "
    >
      <div
        class="mb-6 flex flex-row items-center"
        [ngClass]="{
          'mt-6':
            [typeGoogleApi].indexOf(editConnectionForm.controls['type'].value) >
            -1
        }"
      >
        <div class="flex w-[200px] flex-shrink-0 font-semibold">Headers</div>

        <!-- <button
        type="button"
        data-cy="editConnectionDialogAddHeaderButton"
        class="ml-5 h-11 flex-shrink-0 select-none rounded border border-s400 px-4 py-2 text-base font-medium text-s500 hover:bg-m0 focus:outline-none"
        (click)="showLog()"
        >Log</button
      > -->
      </div>

      <div
        *ngIf="
          [typeGoogleApi].indexOf(editConnectionForm.controls['type'].value) >
          -1
        "
        class="text-s400 mb-6 w-[628px]"
        >For this connection type, the Authorization (Bearer token) and
        Content-Type (application/json) headers will be automatically added. The
        Authorization Bearer token will be obtained using the Service Account
        Credentials.
      </div>

      <div formArrayName="headers">
        <div class="flex flex-col">
          <div *ngFor="let header of getHeaders().controls; let i = index">
            <div
              [formGroupName]="i"
              class="mb-6 flex w-[700px] flex-row items-center"
            >
              <button
                class="text-s500 flex h-9 w-9 flex-shrink-0 items-center justify-center rounded focus:outline-none"
                (click)="removeHeader(i)"
              >
                <m-trash-icon></m-trash-icon>
              </button>

              <div class="ml-5 select-none">Key</div>

              <input
                class="form-input border-s3 focus:border-m600 ml-5 w-[160px] rounded"
                autocomplete="off"
                spellcheck="false"
                data-cy="editConnectionHeaderKeyInput"
                formControlName="key"
              />

              <div class="ml-5 select-none">Value</div>

              <input
                class="form-input border-s3 focus:border-m600 ml-5 w-full rounded"
                autocomplete="off"
                spellcheck="false"
                data-cy="editConnectionHeaderKeyInput"
                formControlName="value"
                placeholder="Will be empty after Save if not set"
              />
            </div>
          </div>
        </div>
      </div>

      <button
        type="button"
        data-cy="editConnectionDialogAddHeaderButton"
        class="border-s400 text-s500 hover:bg-s100 h-11 flex-shrink-0 rounded border px-4 text-base leading-3 shadow-sm focus:outline-none"
        (click)="addHeader()"
        >Add Header</button
      >
    </div>

    <div
      *ngIf="
        [typeBigQuery].indexOf(editConnectionForm.controls['type'].value) > -1
      "
    >
      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold"
          >Query Size Limit, gb</div
        >

        <div class="flex flex-col">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="editConnectionDialogBigqueryQuerySizeLimitGbInput"
            class="form-input border-s3 focus:border-m600 w-80 rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['bigqueryQuerySizeLimitGb']
                  .invalid &&
                editConnectionForm.controls['bigqueryQuerySizeLimitGb'].touched
            }"
            formControlName="bigqueryQuerySizeLimitGb"
            placeholder="Query Size Limit, gb (default: 1)"
          />
          <m-validation
            [control]="editConnectionForm.controls['bigqueryQuerySizeLimitGb']"
          ></m-validation>
        </div>
      </div>
    </div>

    <div
      *ngIf="
        editConnectionForm.controls['type'].value === typePostgreSQL ||
        editConnectionForm.controls['type'].value === typeClickHouse
      "
    >
      <div class="mb-6 flex flex-row items-center">
        <div class="w-[200px] flex-shrink-0 font-semibold">{{
          editConnectionForm.controls['type'].value === typeClickHouse
            ? 'HTTPS'
            : editConnectionForm.controls['type'].value === typePostgreSQL
              ? 'SSL'
              : ''
        }}</div>

        <div class="flex flex-col">
          <div
            class="flex max-w-min cursor-pointer flex-row items-center"
            (click)="toggleSSL()"
          >
            <ui-switch class="" [checked]="isSSL" color="#64BD63"></ui-switch>
          </div>
        </div>
      </div>

      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Host</div>

        <div class="flex flex-col">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="editConnectionDialogHostInput"
            class="form-input border-s3 focus:border-m600 w-[400px] rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['host'].invalid &&
                editConnectionForm.controls['host'].touched
            }"
            formControlName="host"
          />
          <m-validation
            [control]="editConnectionForm.controls['host']"
          ></m-validation>
        </div>
      </div>

      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Port</div>

        <div class="flex flex-col">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="editConnectionDialogPortInput"
            class="form-input border-s3 focus:border-m600 w-[400px] rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['port'].invalid &&
                editConnectionForm.controls['port'].touched
            }"
            formControlName="port"
          />
          <m-validation
            [control]="editConnectionForm.controls['port']"
          ></m-validation>
        </div>
      </div>
    </div>

    <div *ngIf="editConnectionForm.controls['type'].value === typeSnowFlake">
      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Account</div>

        <div class="flex flex-col">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="editConnectionDialogAccountInput"
            class="form-input border-s3 focus:border-m600 w-[400px] rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['account'].invalid &&
                editConnectionForm.controls['account'].touched
            }"
            formControlName="account"
          />
          <m-validation
            [control]="editConnectionForm.controls['account']"
          ></m-validation>
        </div>
      </div>
    </div>

    <div *ngIf="editConnectionForm.controls['type'].value === typeSnowFlake">
      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Warehouse</div>

        <div class="flex flex-col">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="editConnectionDialogWarehouseInput"
            class="form-input border-s3 focus:border-m600 w-[400px] rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['warehouse'].invalid &&
                editConnectionForm.controls['warehouse'].touched
            }"
            formControlName="warehouse"
          />
          <m-validation
            [control]="editConnectionForm.controls['warehouse']"
          ></m-validation>
        </div>
      </div>
    </div>

    <div
      *ngIf="
        editConnectionForm.controls['type'].value === typePostgreSQL ||
        editConnectionForm.controls['type'].value === typeClickHouse ||
        editConnectionForm.controls['type'].value === typeSnowFlake
      "
    >
      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Database</div>

        <div class="flex flex-col">
          <input
            autocomplete="off"
            *ngIf="editConnectionForm.controls['type'].value !== typeClickHouse"
            spellcheck="false"
            data-cy="editConnectionDialogDatabaseInput"
            class="form-input border-s3 focus:border-m600 w-[400px] rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['database'].invalid &&
                editConnectionForm.controls['database'].touched
            }"
            formControlName="database"
            [placeholder]="
              editConnectionForm.controls['type'].value === typeSnowFlake
                ? 'Optional'
                : ''
            "
          />
          <m-validation
            *ngIf="editConnectionForm.controls['type'].value !== typeClickHouse"
            [control]="editConnectionForm.controls['database']"
          ></m-validation>
        </div>
      </div>
    </div>

    <div
      *ngIf="
        editConnectionForm.controls['type'].value === typeSnowFlake ||
        editConnectionForm.controls['type'].value === typeClickHouse ||
        editConnectionForm.controls['type'].value === typePostgreSQL
      "
    >
      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">User</div>

        <div class="flex flex-col">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="editConnectionDialogUserInput"
            class="form-input border-s3 focus:border-m600 w-[400px] rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['username'].invalid &&
                editConnectionForm.controls['username'].touched
            }"
            formControlName="username"
          />
          <m-validation
            [control]="editConnectionForm.controls['username']"
          ></m-validation>
        </div>
      </div>

      <div class="flex flex-row items-center">
        <div class="mb-6 w-[200px] flex-shrink-0 font-semibold">Password</div>

        <div class="flex flex-col">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="editConnectionDialogPasswordInput"
            class="form-input border-s3 focus:border-m600 w-[400px] rounded"
            [ngClass]="{
              'border-r600':
                editConnectionForm.controls['password'].invalid &&
                editConnectionForm.controls['password'].touched
            }"
            formControlName="password"
            type="password"
          />
          <m-validation
            [control]="editConnectionForm.controls['password']"
          ></m-validation>
        </div>
      </div>
    </div>

    <div class="mt-9">
      <button
        data-cy="editConnectionDialogSaveButton"
        class="bg-m600 text-m0 w-28 rounded py-3 text-base font-medium focus:outline-none"
        type="submit"
        >Save</button
      >

      <button
        data-cy="editConnectionDialogCancelButton"
        class="border-m600 text-m600 ml-3 w-28 rounded border py-3 text-base font-medium focus:outline-none"
        type="button"
        (click)="cancel()"
        >Cancel</button
      >
    </div>
  </form>
</div>
