<div class="flex flex-col h-full">
  <div
    class="flex mt-6 mx-6 mb-6 flex-row items-center space-x-3 font-semibold text-2xl text-red1"
  >
    <m-exclamation-icon></m-exclamation-icon>
    <div>BlockML Errors</div>
  </div>

  <div class="flex px-5 flex-grow w-full overflow-y-auto">
    <tree-root
      class="w-full h-2 mt-4"
      #itemsTree
      [nodes]="nodes"
      [options]="treeOptions"
      (initialized)="treeOnInitialized()"
      (updateData)="treeOnUpdateData()"
    >
      <ng-template #treeNodeTemplate let-node="node" let-index="index">
        <div class="flex flex-row w-full">
          <div
            data-cy="blockmlErrorsTreeItem"
            class="flex min-h-[44px] flex-row px-5 w-full select-none"
            [ngClass]="{
              ' cursor-pointer': node.data.isError === false,
              'bg-blue-100':
                node.data.isError === false &&
                !!fileNodeId &&
                node.data.id === fileNodeId,
              'hover:bg-blue2':
                node.data.isError === false &&
                (!fileNodeId || node.data.id !== fileNodeId)
            }"
            (click)="nodeOnClick(node)"
          >
            <div
              class="flex flex-row flex-1 items-center w-full"
              [ngClass]="{
                'ml-2': node.data.isError
              }"
            >
              <div class="flex items-center flex-1 min-w-[2px]">
                <div class="flex flex-row space-x-1 flex-shrink-0">
                  <div class="h-6 w-6" *ngIf="!node.hasChildren"></div>
                  <m-chevron-right-icon
                    *ngIf="!node.isExpanded && node.hasChildren"
                  ></m-chevron-right-icon>
                  <m-chevron-down-icon
                    *ngIf="node.isExpanded && node.hasChildren"
                  ></m-chevron-down-icon>
                </div>

                <div
                  class="flex items-center ml-2 text-base min-w-[2px] min-h-[44px] truncate"
                  *ngIf="node.data.isError === false"
                >
                  {{ node?.data.name }}
                </div>

                <div
                  *ngIf="node.data.isError === true"
                  class="flex mt-3 mb-3 flex-1 flex-col"
                >
                  <div class="flex text-red1 text-base w-full">{{
                    node.data.title
                  }}</div>

                  <div class="flex mt-2 mb-1 w-full text-gray-500 text-base">{{
                    node.data.message | capitalize
                  }}</div>

                  <div
                    *ngFor="let line of node.data.lines"
                    class="flex pl-5 py-2 hover:bg-blue2 text-base hover:cursor-pointer"
                    (click)="goToFileLine(line)"
                  >
                    <div class="flex flex-row w-full">
                      <div
                        class="flex font-semibold"
                        *ngIf="line.fileId === node.parent?.data.id"
                        >line:
                        {{ line.lineNumber === 0 ? '-' : line.lineNumber }}</div
                      >
                      <div
                        class="flex font-semibold"
                        *ngIf="line.fileId !== node.parent?.data.id"
                        >line:
                        {{ line.lineNumber === 0 ? '-' : line.lineNumber }}

                        <span class="ml-5">
                          {{ line.fileName }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </tree-root>
  </div>
</div>

<div *ngIf="struct$ | async"></div>
<div *ngIf="file$ | async"></div>
