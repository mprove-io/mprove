<div class="group h-full w-full rounded border border-white bg-white shadow">
  <div class="h-full">
    <div class="flex h-full w-full flex-col">
      <div
        class="text-gray1 mx-5 mb-5 mt-8 flex flex-shrink-0 flex-row items-start justify-center text-lg"
      >
        <div class="mr-5 w-9"></div>

        <div
          *ngIf="!!mconfig && mconfig.warnSelect.length > 0"
          class="mr-3 mt-1 flex h-8 w-8 flex-shrink-0"
        >
        </div>

        <div class="mx-5 flex w-9 flex-shrink-0"></div>

        <div
          class="text-gray1 flex max-h-[60px] flex-grow cursor-pointer flex-col items-center justify-start hover:text-blue-500"
          (click)="showChart()"
        >
          <div
            class="mt-[2px] line-clamp-2 flex max-h-[60px] flex-col items-center text-center"
          >
            {{ title }}
          </div>
        </div>

        <div class="relative mx-5 flex h-9 w-9 flex-shrink-0">
          <ngx-spinner
            [name]="chart.chartId"
            color="rgba(54, 94, 224, 100)"
            bdColor="rgba(0, 0, 0, 0)"
            size="default"
            type="ball-clip-rotate"
            [fullScreen]="false"
            [disableAnimation]="true"
            [zIndex]="99998"
          >
          </ngx-spinner>
        </div>

        <div
          *ngIf="!!mconfig && mconfig.warnSelect.length > 0"
          class="ml-3 mt-1 flex h-8 w-8 flex-shrink-0 text-purple-500"
          tp="Warning: The selected fields [{{
            mconfig.warnSelect.join(', ')
          }}] may use unsafe aggregations and produce incorrect results"
          placement="left"
        >
          <m-exclamation-icon></m-exclamation-icon>
        </div>

        <button
          data-cy="chartOptionsMenuButton"
          class="invisible ml-5 flex h-9 w-9 flex-shrink-0 items-center justify-center rounded hover:bg-blue-200 focus:outline-none group-hover:visible"
          #t1="tippy"
          [tp]="templateChartMenuOptions"
          [tpHideOnEscape]="true"
          tpVariation="menu"
          className="my-menu"
        >
          <m-dots-vertical-icon></m-dots-vertical-icon>
        </button>

        <ng-template #templateChartMenuOptions>
          <div class="border-gray4 w-64 rounded-md border-2 bg-white shadow-xl">
            <button
              data-cy="chartOptionsRun"
              class="text-gray1 hover:bg-blue2 w-full px-4 py-2 text-left text-base focus:outline-none"
              (click)="t1.hide(); run($event)"
              >Run</button
            >

            <ng-template #templateChartMenuOptionsExploreChart>
              <div *ngIf="isExplorer === false">Explorer role required</div>
              <div *ngIf="isExplorer === true">No access to model</div>
            </ng-template>

            <div
              [tp]="templateChartMenuOptionsExploreChart"
              placement="left"
              [tpIsEnabled]="chart.canEditOrDeleteChart === false"
            >
              <button
                data-cy="chartOptionsExplore"
                class="text-gray1 hover:bg-blue2 w-full px-4 py-2 text-left text-base focus:outline-none"
                [ngClass]="{
                  'cursor-default text-gray-400':
                    chart.tiles[0].hasAccessToModel === false
                }"
                (click)="t1.hide(); explore($event)"
                [disabled]="chart.tiles[0].hasAccessToModel === false"
                >Explore</button
              >
            </div>

            <div
              tp="Chart can be edited by author and project members with ProjectAdmin or FilesEditor role. Try to save chart as new to become an author."
              placement="left"
              [tpIsEnabled]="chart.canEditOrDeleteChart === false"
            >
              <button
                data-cy="chartOptionsEditInfo"
                class="text-gray1 hover:bg-blue2 w-full px-4 py-2 text-left text-base focus:outline-none"
                [ngClass]="{
                  'cursor-default text-gray-400':
                    chart.canEditOrDeleteChart === false
                }"
                (click)="t1.hide(); editChartInfo($event)"
                [disabled]="chart.canEditOrDeleteChart === false"
                >Edit Info</button
              >
            </div>

            <button
              data-cy="chartOptionsGoToFile"
              class="text-gray1 hover:bg-blue2 w-full px-4 py-2 text-left text-base focus:outline-none"
              (click)="t1.hide(); goToFile($event)"
              >Go to file</button
            >

            <div
              tp="Chart can be deleted by author and project members with ProjectAdmin or FilesEditor role. Try to save chart as new to become an author."
              placement="left"
              [tpIsEnabled]="chart.canEditOrDeleteChart === false"
            >
              <button
                data-cy="chartOptionsDelete"
                class="text-gray1 hover:bg-blue2 w-full px-4 py-2 text-left text-base focus:outline-none"
                [ngClass]="{
                  'cursor-default text-gray-400':
                    chart.canEditOrDeleteChart === false
                }"
                (click)="t1.hide(); deleteChart($event)"
                [disabled]="chart.canEditOrDeleteChart === false"
                >Delete</button
              >
            </div>
          </div>
        </ng-template>
      </div>

      <m-bricks
        class="mx-7 mb-5 flex max-h-[120px] max-w-max flex-shrink-0 flex-row items-start justify-start overflow-auto"
        *ngIf="showBricks === true && mconfig?.filters.length > 0"
        [extendedFilters]="mconfig.extendedFilters"
        [isKeepBackgroundColor]="false"
      ></m-bricks>

      <div
        class="flex w-full flex-grow cursor-default overflow-auto rounded bg-white px-7 pb-10 pt-5"
        (click)="stopClick($event)"
      >
        <m-chart-view
          *ngIf="!!mconfig?.chart"
          [ngClass]="{
            'max-w-max':
              mconfig?.chart.type === chartTypeEnumTable &&
              isSelectValid === true &&
              mconfig?.chart.isValid === true &&
              qData?.length > 0
          }"
          class="h-full w-full"
          [mconfigFields]="mconfig.fields"
          [qData]="qData"
          [chart]="mconfig?.chart"
          [queryStatus]="query?.status"
          [chartInstanceId]="'chart-mconfig-id-' + mconfig?.mconfigId"
        ></m-chart-view>
      </div>
    </div>
  </div>
</div>

<div *ngIf="nav$ | async"></div>
<div *ngIf="isExplorer$ | async"></div>
