<div class="ml-2 flex h-16 flex-row space-x-5">
  <div
    tp="Turn off formula to activate control"
    [tpIsEnabled]="isDisabled === true"
  >
    <ng-container *ngTemplateOutlet="tSelect"></ng-container>

    <ng-template #tSelect>
      <ng-select
        #fractionTsTypeSelect
        [fixNgSelectBottom]="fractionTsTypeSelect"
        data-cy="fractionTsTypeSelect"
        class="fraction-type-select"
        [class.w-[138px]]="
          isMetrics === true && fraction.type === 'TsIsInRange'
        "
        [class.w-[140px]]="
          isMetrics === false && fraction.type === 'TsIsInRange'
        "
        [class.w-[230px]]="
          isMetrics === true && fraction.type !== 'TsIsInRange'
        "
        [class.w-[280px]]="
          isMetrics === false && fraction.type !== 'TsIsInRange'
        "
        [items]="fractionTsTypesList"
        [clearable]="false"
        [searchable]="false"
        [disabled]="isDisabled === true"
        [(ngModel)]="fraction.type"
        (change)="typeChange($event)"
        (keyup.esc)="
          $event.stopImmediatePropagation(); fractionTsTypeSelect.blur()
        "
        (keyup.enter)="
          $event.stopImmediatePropagation(); fractionTsTypeSelect.blur()
        "
        appendTo="body"
        bindLabel="label"
        bindValue="value"
      >
        <ng-template ng-label-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div class="flex flex-row">
            <div class="ml-1" *ngIf="isMetrics === false"
              >{{ item.operator | uppercase }} -</div
            >
            <div class="ml-1 truncate">{{ item.label }}</div>
          </div>
        </ng-template>
      </ng-select>
    </ng-template>
  </div>

  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsOnYear ||
      fraction.type === fractionTypeEnum.TsIsOnQuarter ||
      fraction.type === fractionTypeEnum.TsIsOnMonth ||
      fraction.type === fractionTypeEnum.TsIsOnWeek ||
      fraction.type === fractionTypeEnum.TsIsOnDay ||
      fraction.type === fractionTypeEnum.TsIsOnHour ||
      fraction.type === fractionTypeEnum.TsIsOnMinute ||
      fraction.type === fractionTypeEnum.TsIsBeforeDate ||
      fraction.type === fractionTypeEnum.TsIsThrough ||
      fraction.type === fractionTypeEnum.TsIsAfterDate ||
      fraction.type === fractionTypeEnum.TsIsStarting ||
      fraction.type === fractionTypeEnum.TsIsBeginFor
    "
  >
    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <ng-select
        #fractionTsMomentTypeSelect
        [fixNgSelectBottom]="fractionTsMomentTypeSelect"
        data-cy="fractionTsMomentTypeSelect"
        class="popup-55 w-[140px]"
        [items]="fractionTsMomentTypesList"
        [clearable]="false"
        [searchable]="false"
        [disabled]="isDisabled === true"
        [(ngModel)]="fraction.tsMomentType"
        (change)="tsFractionMomentChange()"
        (keyup.esc)="
          $event.stopImmediatePropagation(); fractionTsMomentTypeSelect.blur()
        "
        (keyup.enter)="
          $event.stopImmediatePropagation(); fractionTsMomentTypeSelect.blur()
        "
        appendTo="body"
        bindLabel="label"
        bindValue="value"
      >
        <ng-template ng-label-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>
      </ng-select>
    </div>
  </div>

  <div
    *ngIf="
      [
        fractionTypeEnum.TsIsOnYear,
        fractionTypeEnum.TsIsOnQuarter,
        fractionTypeEnum.TsIsOnMonth,
        fractionTypeEnum.TsIsOnWeek,
        fractionTypeEnum.TsIsOnDay,
        fractionTypeEnum.TsIsOnHour,
        fractionTypeEnum.TsIsOnMinute,
        fractionTypeEnum.TsIsBeforeDate,
        fractionTypeEnum.TsIsThrough,
        fractionTypeEnum.TsIsAfterDate,
        fractionTypeEnum.TsIsStarting,
        fractionTypeEnum.TsIsBeginFor
      ].indexOf(fraction.type) > -1 &&
      [
        fractionTsMomentTypeEnum.LastDayOfWeek,
        fractionTsMomentTypeEnum.NextDayOfWeek
      ].indexOf(fraction.tsMomentType) > -1
    "
    tp="Turn off formula to activate control"
    [tpIsEnabled]="isDisabled === true"
  >
    <ng-select
      #tsMomentDayOfWeekSelect
      [fixNgSelectBottom]="tsMomentDayOfWeekSelect"
      data-cy="tsMomentDayOfWeekSelect"
      class="popup-55 w-[160px]"
      [items]="fractionTsDayOfWeekLcList"
      [clearable]="false"
      [searchable]="false"
      [disabled]="isDisabled === true"
      [(ngModel)]="fraction.tsMomentPartValue"
      (change)="tsMomentDayOfWeekChange()"
      (keyup.esc)="
        $event.stopImmediatePropagation(); tsMomentDayOfWeekSelect.blur()
      "
      (keyup.enter)="
        $event.stopImmediatePropagation(); tsMomentDayOfWeekSelect.blur()
      "
      appendTo="body"
      bindLabel="label"
      bindValue="value"
    >
      <ng-template ng-label-tmp let-item="item">
        <div class="ml-1 truncate">{{ item.label }}</div>
      </ng-template>

      <ng-template ng-option-tmp let-item="item">
        <div class="ml-1 truncate">{{ item.label }}</div>
      </ng-template>
    </ng-select>
  </div>

  <div
    *ngIf="
      [
        fractionTypeEnum.TsIsOnYear,
        fractionTypeEnum.TsIsOnQuarter,
        fractionTypeEnum.TsIsOnMonth,
        fractionTypeEnum.TsIsOnWeek,
        fractionTypeEnum.TsIsOnDay,
        fractionTypeEnum.TsIsOnHour,
        fractionTypeEnum.TsIsOnMinute,
        fractionTypeEnum.TsIsBeforeDate,
        fractionTypeEnum.TsIsThrough,
        fractionTypeEnum.TsIsAfterDate,
        fractionTypeEnum.TsIsStarting,
        fractionTypeEnum.TsIsBeginFor
      ].indexOf(fraction.type) > -1 &&
      [
        fractionTsMomentTypeEnum.This,
        fractionTsMomentTypeEnum.Last,
        fractionTsMomentTypeEnum.Next
      ].indexOf(fraction.tsMomentType) > -1
    "
    tp="Turn off formula to activate control"
    [tpIsEnabled]="isDisabled === true"
  >
    <ng-select
      #tsMomentSingularUnitSelect
      [fixNgSelectBottom]="tsMomentSingularUnitSelect"
      data-cy="tsMomentSingularUnitSelect"
      class="popup-55 w-32"
      [items]="fractionTsSingularUnitsList"
      [clearable]="false"
      [searchable]="false"
      [disabled]="isDisabled === true"
      [(ngModel)]="fraction.tsMomentUnit"
      (change)="tsMomentSingularUnitChange()"
      (keyup.esc)="
        $event.stopImmediatePropagation(); tsMomentSingularUnitSelect.blur()
      "
      (keyup.enter)="
        $event.stopImmediatePropagation(); tsMomentSingularUnitSelect.blur()
      "
      appendTo="body"
      bindLabel="label"
      bindValue="value"
    >
      <ng-template ng-label-tmp let-item="item">
        <div class="ml-1 truncate">{{ item.label }}</div>
      </ng-template>

      <ng-template ng-option-tmp let-item="item">
        <div class="ml-1 truncate">{{ item.label }}</div>
      </ng-template>
    </ng-select>
  </div>

  <div
    *ngIf="
      [
        fractionTypeEnum.TsIsOnYear,
        fractionTypeEnum.TsIsOnQuarter,
        fractionTypeEnum.TsIsOnMonth,
        fractionTypeEnum.TsIsOnWeek,
        fractionTypeEnum.TsIsOnDay,
        fractionTypeEnum.TsIsOnHour,
        fractionTypeEnum.TsIsOnMinute,
        fractionTypeEnum.TsIsBeforeDate,
        fractionTypeEnum.TsIsThrough,
        fractionTypeEnum.TsIsAfterDate,
        fractionTypeEnum.TsIsStarting,
        fractionTypeEnum.TsIsBeginFor
      ].indexOf(fraction.type) > -1 &&
      [fractionTsMomentTypeEnum.Ago, fractionTsMomentTypeEnum.FromNow].indexOf(
        fraction.tsMomentType
      ) > -1
    "
    class="flex flex-row space-x-5"
  >
    <form [formGroup]="tsMomentNumValueForm">
      <div
        tp="Turn off formula to activate control"
        [tpIsEnabled]="isDisabled === true"
      >
        <fieldset [disabled]="isDisabled === true">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="fractionTsMomentNumValueInput"
            class="form-input border-s3 focus:border-m600 h-[36px] w-16 rounded"
            [ngClass]="{
              'border-r600':
                tsMomentNumValueForm.controls['tsMomentNumValue'].invalid &&
                tsMomentNumValueForm.controls['tsMomentNumValue'].touched
            }"
            formControlName="tsMomentNumValue"
            (blur)="tsMomentNumValueBlur()"
          />
        </fieldset>
      </div>

      <m-validation
        [control]="tsMomentNumValueForm.controls['tsMomentNumValue']"
      ></m-validation>
    </form>

    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <ng-select
        #tsMomentAgoFromNowUnitSelect
        [fixNgSelectBottom]="tsMomentAgoFromNowUnitSelect"
        data-cy="tsMomentAgoFromNowUnitSelect"
        class="popup-55 w-32"
        [items]="fractionTsAgoFromNowUnitsList"
        [clearable]="false"
        [searchable]="false"
        [disabled]="isDisabled === true"
        [(ngModel)]="fraction.tsMomentUnit"
        (change)="tsMomentAgoFromNowUnitChange()"
        (keyup.esc)="
          $event.stopImmediatePropagation(); tsMomentAgoFromNowUnitSelect.blur()
        "
        (keyup.enter)="
          $event.stopImmediatePropagation(); tsMomentAgoFromNowUnitSelect.blur()
        "
        appendTo="body"
        bindLabel="label"
        bindValue="value"
      >
        <ng-template ng-label-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>
      </ng-select>
    </div>
  </div>

  <div *ngIf="fraction.type === fractionTypeEnum.TsIsInRange">
    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <ng-select
        #fractionTsFromMomentTypeSelect
        [fixNgSelectBottom]="fractionTsFromMomentTypeSelect"
        data-cy="fractionTsFromMomentTypeSelect"
        class="popup-55 w-32"
        [items]="fractionTsMomentTypesList"
        [clearable]="false"
        [searchable]="false"
        [disabled]="isDisabled === true"
        [(ngModel)]="fraction.tsFromMomentType"
        (change)="tsFractionFromMomentChange()"
        (keyup.esc)="
          $event.stopImmediatePropagation();
          fractionTsFromMomentTypeSelect.blur()
        "
        (keyup.enter)="
          $event.stopImmediatePropagation();
          fractionTsFromMomentTypeSelect.blur()
        "
        appendTo="body"
        bindLabel="label"
        bindValue="value"
      >
        <ng-template ng-label-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>
      </ng-select>
    </div>
  </div>

  <div
    *ngIf="
      ((fraction.type === fractionTypeEnum.TsIsBeforeDate ||
        fraction.type === fractionTypeEnum.TsIsThrough ||
        fraction.type === fractionTypeEnum.TsIsAfterDate ||
        fraction.type === fractionTypeEnum.TsIsStarting ||
        fraction.type === fractionTypeEnum.TsIsBeginFor) &&
        fraction.tsMomentType === fractionTsMomentTypeEnum.Literal) ||
      (fraction.type === fractionTypeEnum.TsIsInRange &&
        (fraction.tsFromMomentType === fractionTsMomentTypeEnum.Literal ||
          fraction.tsToMomentType === fractionTsMomentTypeEnum.Literal))
    "
    tp="The switch is disabled if the time is not 00:00"
    [tpIsEnabled]="
      timeStr !== zeroHoursMinutes ||
      (fraction.type === fractionTypeEnum.TsIsInRange &&
        timeToStr !== zeroHoursMinutes)
    "
  >
    <button
      class="flex h-9 w-9 flex-shrink-0 items-center justify-center rounded focus:outline-none"
      [ngClass]="{
        'cursor-pointer':
          timeStr === zeroHoursMinutes &&
          (fraction.type !== fractionTypeEnum.TsIsInRange ||
            timeToStr === zeroHoursMinutes),
        'text-m500':
          showHours === true &&
          timeStr === zeroHoursMinutes &&
          (fraction.type !== fractionTypeEnum.TsIsInRange ||
            timeToStr === zeroHoursMinutes),
        'text-s500':
          showHours === false &&
          timeStr === zeroHoursMinutes &&
          (fraction.type !== fractionTypeEnum.TsIsInRange ||
            timeToStr === zeroHoursMinutes),
        'text-s300 cursor-default':
          timeStr !== zeroHoursMinutes ||
          (fraction.type === fractionTypeEnum.TsIsInRange &&
            timeToStr !== zeroHoursMinutes)
      }"
      [disabled]="
        timeStr !== zeroHoursMinutes ||
        (fraction.type === fractionTypeEnum.TsIsInRange &&
          timeToStr !== zeroHoursMinutes)
      "
      (click)="toggleShowHours()"
    >
      <m-clock-icon></m-clock-icon>
    </button>
  </div>

  <!-- on year -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsOnYear &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    tp="Turn off formula to activate control"
    [tpIsEnabled]="isDisabled === true"
  >
    <vaadin-date-picker
      #datePickerOnYear
      class="py-0"
      required
      [value]="dateStr"
      [i18n]="onYearDateI18n"
      (value-changed)="yearDateValueChanged($event)"
      [disabled]="isDisabled === true"
    ></vaadin-date-picker>
  </div>

  <!-- on month -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsOnMonth &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    tp="Turn off formula to activate control"
    [tpIsEnabled]="isDisabled === true"
  >
    <vaadin-date-picker
      #datePickerOnMonth
      class="py-0"
      required
      [value]="dateStr"
      [i18n]="onMonthDateI18n"
      (value-changed)="monthDateValueChanged($event)"
      [disabled]="isDisabled === true"
    ></vaadin-date-picker>
  </div>

  <!-- on day -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsOnDay &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    tp="Turn off formula to activate control"
    [tpIsEnabled]="isDisabled === true"
  >
    <vaadin-date-picker
      #datePickerOnDay
      class="py-0"
      required
      [value]="dateStr"
      [i18n]="onDayDateI18n"
      (value-changed)="dayDateValueChanged($event)"
      [disabled]="isDisabled === true"
    ></vaadin-date-picker>
  </div>

  <!-- on hour -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsOnHour &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    class="flex flex-row space-x-5"
  >
    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-date-picker
        #datePickerOnHour
        class="py-0"
        required
        [value]="dateStr"
        [i18n]="onHourDateI18n"
        (value-changed)="hourDateValueChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-date-picker>
    </div>

    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-time-picker
        #timePickerOnHour
        class="py-0"
        required
        [value]="timeStr"
        (value-changed)="hourTimeValueChanged($event)"
        (opened-changed)="hourTimeOpenedChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-time-picker>
    </div>
  </div>

  <!-- on minute -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsOnMinute &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    class="flex flex-row space-x-5"
  >
    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-date-picker
        #datePickerOnMinute
        class="py-0"
        required
        [value]="dateStr"
        [i18n]="onMinuteDateI18n"
        (value-changed)="minuteDateValueChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-date-picker>
    </div>

    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-time-picker
        #timePickerOnMinute
        class="py-0"
        required
        [value]="timeStr"
        (value-changed)="minuteTimeValueChanged($event)"
        (opened-changed)="minuteTimeOpenedChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-time-picker>
    </div>
  </div>

  <!-- in range -->
  <div
    *ngIf="fraction.type === fractionTypeEnum.TsIsInRange"
    class="flex flex-row space-x-5"
  >
    <div
      *ngIf="fraction.tsFromMomentType === fractionTsMomentTypeEnum.Literal"
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-date-picker
        #datePickerInRangeFrom
        class="py-0"
        required
        [value]="dateStr"
        [i18n]="inRangeFromDateI18n"
        (value-changed)="inRangeFromDateValueChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-date-picker>
    </div>

    <div
      *ngIf="
        fraction.tsFromMomentType === fractionTsMomentTypeEnum.Literal &&
        (showHours === true ||
          timeStr !== zeroHoursMinutes ||
          timeToStr !== zeroHoursMinutes)
      "
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-time-picker
        #timePickerInRangeFrom
        class="py-0"
        required
        [value]="timeStr"
        (value-changed)="inRangeFromTimeValueChanged($event)"
        (opened-changed)="inRangeFromTimeOpenedChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-time-picker>
    </div>

    <div class="flex h-[36px] items-center justify-center">to</div>

    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <ng-select
        #fractionTsToMomentTypeSelect
        [fixNgSelectBottom]="fractionTsToMomentTypeSelect"
        data-cy="fractionTsToMomentTypeSelect"
        class="popup-55 w-32"
        [items]="fractionTsMomentTypesList"
        [clearable]="false"
        [searchable]="false"
        [disabled]="isDisabled === true"
        [(ngModel)]="fraction.tsToMomentType"
        (change)="tsFractionToMomentChange()"
        (keyup.esc)="
          $event.stopImmediatePropagation(); fractionTsToMomentTypeSelect.blur()
        "
        (keyup.enter)="
          $event.stopImmediatePropagation(); fractionTsToMomentTypeSelect.blur()
        "
        appendTo="body"
        bindLabel="label"
        bindValue="value"
      >
        <ng-template ng-label-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>
      </ng-select>
    </div>

    <div
      *ngIf="fraction.tsToMomentType === fractionTsMomentTypeEnum.Literal"
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-date-picker
        #datePickerInRangeTo
        class="py-0"
        required
        [value]="dateToStr"
        [i18n]="inRangeToDateI18n"
        (value-changed)="inRangeToDateValueChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-date-picker>
    </div>

    <div
      *ngIf="
        fraction.tsToMomentType === fractionTsMomentTypeEnum.Literal &&
        (showHours === true ||
          timeStr !== zeroHoursMinutes ||
          timeToStr !== zeroHoursMinutes)
      "
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-time-picker
        #timePickerInRangeTo
        class="py-0"
        required
        [value]="timeToStr"
        (value-changed)="inRangeToTimeValueChanged($event)"
        (opened-changed)="inRangeToTimeOpenedChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-time-picker>
    </div>
  </div>

  <!-- is before -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsBeforeDate &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    class="flex flex-row space-x-5"
  >
    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-date-picker
        #datePickerBefore
        class="py-0"
        required
        [value]="dateStr"
        [i18n]="beforeDateI18n"
        (value-changed)="beforeDateValueChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-date-picker>
    </div>

    <div
      *ngIf="showHours === true || timeStr !== zeroHoursMinutes"
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-time-picker
        #timePickerBefore
        class="py-0"
        required
        [value]="timeStr"
        (value-changed)="beforeTimeValueChanged($event)"
        (opened-changed)="beforeTimeOpenedChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-time-picker>
    </div>
  </div>

  <!-- is through -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsThrough &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    class="flex flex-row space-x-5"
  >
    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-date-picker
        #datePickerThrough
        class="py-0"
        required
        [value]="dateStr"
        [i18n]="throughI18n"
        (value-changed)="throughDateValueChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-date-picker>
    </div>

    <div
      *ngIf="showHours === true || timeStr !== zeroHoursMinutes"
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-time-picker
        #timePickerThrough
        class="py-0"
        required
        [value]="timeStr"
        (value-changed)="throughTimeValueChanged($event)"
        (opened-changed)="throughTimeOpenedChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-time-picker>
    </div>
  </div>

  <!-- is after -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsAfterDate &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    class="flex flex-row space-x-5"
  >
    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-date-picker
        #datePickerAfter
        class="py-0"
        required
        [value]="dateStr"
        [i18n]="afterDateI18n"
        (value-changed)="afterDateValueChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-date-picker>
    </div>

    <div
      *ngIf="showHours === true || timeStr !== zeroHoursMinutes"
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-time-picker
        #timePickerAfter
        class="py-0"
        required
        [value]="timeStr"
        (value-changed)="afterTimeValueChanged($event)"
        (opened-changed)="afterTimeOpenedChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-time-picker>
    </div>
  </div>

  <!-- is starting -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsStarting &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    class="flex flex-row space-x-5"
  >
    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-date-picker
        #datePickerStarting
        class="py-0"
        required
        [value]="dateStr"
        [i18n]="startingI18n"
        (value-changed)="startingDateValueChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-date-picker>
    </div>

    <div
      *ngIf="showHours === true || timeStr !== zeroHoursMinutes"
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-time-picker
        #timePickerStarting
        class="py-0"
        required
        [value]="timeStr"
        (value-changed)="startingTimeValueChanged($event)"
        (opened-changed)="startingTimeOpenedChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-time-picker>
    </div>
  </div>

  <!-- is begin for -->
  <div
    *ngIf="
      fraction.type === fractionTypeEnum.TsIsBeginFor &&
      fraction.tsMomentType === fractionTsMomentTypeEnum.Literal
    "
    class="flex flex-row space-x-5"
  >
    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-date-picker
        #datePickerBeginFor
        class="py-0"
        required
        [value]="dateStr"
        [i18n]="beginForI18n"
        (value-changed)="beginForDateValueChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-date-picker>
    </div>

    <div
      *ngIf="showHours === true || timeStr !== zeroHoursMinutes"
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <vaadin-time-picker
        #timePickerBeginFor
        class="py-0"
        required
        [value]="timeStr"
        (value-changed)="beginForTimeValueChanged($event)"
        (opened-changed)="beginForTimeOpenedChanged($event)"
        [disabled]="isDisabled === true"
      ></vaadin-time-picker>
    </div>
  </div>

  <!-- begin for -->
  <div
    *ngIf="fraction.type === fractionTypeEnum.TsIsBeginFor"
    class="flex flex-row space-x-5"
  >
    <div class="flex h-9 items-center">for</div>

    <form [formGroup]="tsForValueForm">
      <div
        tp="Turn off formula to activate control"
        [tpIsEnabled]="isDisabled === true"
      >
        <fieldset [disabled]="isDisabled === true">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="fractionTsForValueInput"
            class="form-input border-s3 focus:border-m600 h-[36px] w-16 rounded"
            [ngClass]="{
              'border-r600':
                tsForValueForm.controls['tsForValue'].invalid &&
                tsForValueForm.controls['tsForValue'].touched
            }"
            formControlName="tsForValue"
            (blur)="forValueBlur()"
          />
        </fieldset>
      </div>

      <m-validation
        [control]="tsForValueForm.controls['tsForValue']"
      ></m-validation>
    </form>

    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <ng-select
        #tsForUnitsSelect
        [fixNgSelectBottom]="tsForUnitsSelect"
        data-cy="tsForUnitsSelect"
        class="popup-55 w-32"
        [items]="fractionTsForUnitsList"
        [clearable]="false"
        [searchable]="false"
        [disabled]="isDisabled === true"
        [(ngModel)]="fraction.tsForUnit"
        (change)="tsForUnitChange()"
        (keyup.esc)="$event.stopImmediatePropagation(); tsForUnitsSelect.blur()"
        (keyup.enter)="
          $event.stopImmediatePropagation(); tsForUnitsSelect.blur()
        "
        appendTo="body"
        bindLabel="label"
        bindValue="value"
      >
        <ng-template ng-label-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>
      </ng-select>
    </div>
  </div>

  <!-- in last -->
  <div
    *ngIf="fraction.type === fractionTypeEnum.TsIsInLast"
    class="flex flex-row space-x-5"
  >
    <form [formGroup]="tsLastValueForm">
      <div
        tp="Turn off formula to activate control"
        [tpIsEnabled]="isDisabled === true"
      >
        <fieldset [disabled]="isDisabled === true">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="fractionTsLastValueInput"
            class="form-input border-s3 focus:border-m600 h-[36px] w-[100px] rounded"
            [ngClass]="{
              'border-r600':
                tsLastValueForm.controls['tsLastValue'].invalid &&
                tsLastValueForm.controls['tsLastValue'].touched
            }"
            formControlName="tsLastValue"
            (blur)="tsLastValueBlur()"
          />
        </fieldset>
      </div>

      <m-validation
        [control]="tsLastValueForm.controls['tsLastValue']"
      ></m-validation>
    </form>

    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <ng-select
        #tsLastUnitsSelect
        [fixNgSelectBottom]="tsLastUnitsSelect"
        data-cy="tsLastUnitsSelect"
        class="popup-55 w-32"
        [items]="fractionTsLastUnitsList"
        [clearable]="false"
        [searchable]="false"
        [disabled]="isDisabled === true"
        [(ngModel)]="fraction.tsLastUnit"
        (change)="tsLastUnitChange()"
        (keyup.esc)="
          $event.stopImmediatePropagation(); tsLastUnitsSelect.blur()
        "
        (keyup.enter)="
          $event.stopImmediatePropagation(); tsLastUnitsSelect.blur()
        "
        appendTo="body"
        bindLabel="label"
        bindValue="value"
      >
        <ng-template ng-label-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>
      </ng-select>
    </div>

    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <ng-select
        #tsLastCompleteOptionsSelect
        [fixNgSelectBottom]="tsLastCompleteOptionsSelect"
        data-cy="tsLastCompleteOptionsSelect"
        class="popup-55 w-56"
        [items]="fractionTsLastCompleteOptionsList"
        [clearable]="false"
        [searchable]="false"
        [disabled]="isDisabled === true"
        [(ngModel)]="fraction.tsLastCompleteOption"
        (change)="tsLastCompleteOptionChange()"
        (keyup.esc)="
          $event.stopImmediatePropagation(); tsLastCompleteOptionsSelect.blur()
        "
        (keyup.enter)="
          $event.stopImmediatePropagation(); tsLastCompleteOptionsSelect.blur()
        "
        appendTo="body"
        bindLabel="label"
        bindValue="value"
      >
        <ng-template ng-label-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>
      </ng-select>
    </div>
  </div>

  <!-- in next -->
  <div
    *ngIf="fraction.type === fractionTypeEnum.TsIsInNext"
    class="flex flex-row space-x-5"
  >
    <form [formGroup]="tsNextValueForm">
      <div
        tp="Turn off formula to activate control"
        [tpIsEnabled]="isDisabled === true"
      >
        <fieldset [disabled]="isDisabled === true">
          <input
            autocomplete="off"
            spellcheck="false"
            data-cy="fractionTsNextValueInput"
            class="form-input border-s3 focus:border-m600 h-[36px] w-[100px] rounded"
            [ngClass]="{
              'border-r600':
                tsNextValueForm.controls['tsNextValue'].invalid &&
                tsNextValueForm.controls['tsNextValue'].touched
            }"
            formControlName="tsNextValue"
            (blur)="tsNextValueBlur()"
          />
        </fieldset>
      </div>

      <m-validation
        [control]="tsNextValueForm.controls['tsNextValue']"
      ></m-validation>
    </form>

    <div
      tp="Turn off formula to activate control"
      [tpIsEnabled]="isDisabled === true"
    >
      <ng-select
        #tsNextUnitsSelect
        [fixNgSelectBottom]="tsNextUnitsSelect"
        data-cy="tsNextUnitsSelect"
        class="popup-55 w-32"
        [items]="fractionTsNextUnitsList"
        [clearable]="false"
        [searchable]="false"
        [disabled]="isDisabled === true"
        [(ngModel)]="fraction.tsNextUnit"
        (change)="tsNextUnitChange()"
        (keyup.esc)="
          $event.stopImmediatePropagation(); tsNextUnitsSelect.blur()
        "
        (keyup.enter)="
          $event.stopImmediatePropagation(); tsNextUnitsSelect.blur()
        "
        appendTo="body"
        bindLabel="label"
        bindValue="value"
      >
        <ng-template ng-label-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div class="ml-1 truncate">{{ item.label }}</div>
        </ng-template>
      </ng-select>
    </div>
  </div>
</div>

<div *ngIf="showHours$ | async"></div>
