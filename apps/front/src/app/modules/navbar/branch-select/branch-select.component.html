<ng-select
  #branchSelect
  data-cy="branchSelect"
  class="custom w-72 text-base focus:outline-none"
  (open)="openBranchSelect()"
  [loading]="branchesListLoading"
  [items]="branchesList"
  [clearable]="false"
  [disabled]="selectedProjectId === undefined || needSave === true"
  [searchable]="false"
  [(ngModel)]="selectedBranchExtraId"
  (change)="branchChange()"
  appendTo="body"
  placeholder="Repository - Branch"
  bindLabel="extraName"
  bindValue="extraId"
>
  <ng-template ng-label-tmp let-item="item">
    <!-- &&
    !!selectedBranchItem &&
    selectedBranchItem.branchId !== branchMaster -->

    <div
      class="flex ml-1 py-[1px] px-[8px] rounded"
      [ngClass]="{
        'bg-green1': !!repo && repo.repoId !== prodRepoID,
        'bg-blue5': !!repo && repo.repoId === prodRepoID
      }"
      >{{ item.extraName }}</div
    >
  </ng-template>

  <ng-template ng-option-tmp let-item="item">
    <!-- [ngClass]="{
    'bg-green1': item.isRepoProd === false,
    'bg-blue5': item.isRepoProd === true && item.branchId !== branchMaster
  }" -->

    <div class="flex ml-1 px-[8px] rounded truncate">{{ item.extraName }}</div>
  </ng-template>

  <ng-template ng-footer-tmp *ngIf="isEditor === true">
    <div class="p-3 text-gray-400" *ngIf="repo.conflicts.length > 0">
      Resolve conflicts to be able to switch, merge, delete or create local
      branches
    </div>

    <div
      class="p-3 text-gray-400"
      *ngIf="
        repo.conflicts.length === 0 && repo.repoStatus === repoStatusNeedCommit
      "
    >
      Commit changes to be able to switch, merge, delete or create local
      branches
    </div>

    <button
      *ngIf="
        repo.conflicts.length === 0 && repo.repoStatus !== repoStatusNeedCommit
      "
      data-cy="branchSelectDeleteBranchButton"
      class="py-3 rounded w-full text-base focus:outline-none"
      [ngClass]="{
        'text-gray-400 cursor-default':
          selectedBranchItem.branchId === branchMaster,
        'text-blue3 hover:bg-blue2':
          selectedBranchItem.branchId !== branchMaster
      }"
      (click)="deleteBranch(branchSelect, $event)"
      [disabled]="selectedBranchItem.branchId === branchMaster"
      >Delete Branch</button
    >

    <div
      class="p-3 text-gray-400"
      *ngIf="
        repo.conflicts.length === 0 &&
        repo.repoStatus !== repoStatusNeedCommit &&
        repo.repoId === prodRepoID
      "
    >
      Switch to local branch to be able to merge, delete or create local
      branches
    </div>

    <button
      *ngIf="
        repo.conflicts.length === 0 &&
        repo.repoStatus !== repoStatusNeedCommit &&
        repo.repoId !== prodRepoID
      "
      data-cy="branchSelectMergeBranchButton"
      class="py-3 rounded w-full text-base focus:outline-none"
      [ngClass]="{
        'text-gray-400 cursor-default': selectedBranchItem.isRepoProd === true,
        'text-blue3 hover:bg-blue2': selectedBranchItem.isRepoProd === false
      }"
      (click)="mergeBranch(branchSelect, $event)"
      [disabled]="selectedBranchItem.isRepoProd === true"
      >Merge Branch</button
    >

    <button
      *ngIf="
        repo.conflicts.length === 0 &&
        repo.repoStatus !== repoStatusNeedCommit &&
        repo.repoId !== prodRepoID
      "
      data-cy="branchSelectCreateBranchButton"
      class="py-3 rounded text-base text-blue3 hover:bg-blue2 w-full focus:outline-none"
      (click)="createNewBranch(branchSelect, $event)"
      >New Local Branch</button
    >
  </ng-template>
</ng-select>

<div *ngIf="repo$ | async"></div>
<div *ngIf="nav$ | async"></div>
<div *ngIf="isEditor$ | async"></div>
<div *ngIf="file$ | async"></div>
<div *ngIf="needSave$ | async"></div>
