<div class="bg-blue1 flex flex-col h-full">
  <div class="flex flex-row h-full">
    <div class="flex flex-col flex-grow mx-6 mb-6 mt-8 min-w-[2px]">
      <div class="flex flex-row justify-between items-center h-11">
        <div class="flex flex-row items-center w-full">
          <div class="flex flex-row items-center space-x-5">
            <div
              data-cy="dashboardTitle"
              class="flex font-semibold text-2xl text-gray1 items-center self-center"
            >
              {{ pageTitle }}
            </div>

            <div class="text-xl text-gray1">{{
              (dashboard?.title ? dashboard?.title : dashboard?.dashboardId)
                | capitalize
            }}</div>

            <button
              type="button"
              data-cy="dashboardSaveAsButton"
              class="w-24 py-2 ml-5 text-white bg-pink-500 text-base rounded font-medium focus:outline-none"
              *ngIf="dashboard?.dashboardId && dashboard.temp === true"
              (click)="saveAs()"
              >Save As</button
            >

            <button
              class="flex flex-row items-center text-blue-500 focus:outline-none"
              *ngIf="dashboard?.dashboardId && dashboard.temp === false"
              (click)="goToFile()"
            >
              <m-arrow-narrow-right-icon></m-arrow-narrow-right-icon>
              <div class="ml-2 text-xl"
                >{{ dashboard.dashboardId }}.dashboard</div
              >
            </button>
          </div>

          <div class="flex flex-row items-center space-x-5">
            <ui-switch
              class="ml-5"
              [checked]="showBricks"
              (change)="toggleShowReportFilters()"
            ></ui-switch>

            <div class="flex h-9 text-gray1 text-base items-center select-none"
              >Show Report Filters</div
            >
          </div>

          <div class="flex-grow"></div>

          <div class="flex flex-row items-center text-base text-gray1">
            <!-- <div *ngIf="!!dryQueryEstimate"
              >Estimate - {{ dryDataSize }} - {{ dryTimeAgo$ | async }}
            </div> -->

            <!-- <m-query-status
              *ngIf="!dryQueryEstimate"
              [query]="query"
            ></m-query-status> -->

            <!-- <ui-switch
              class="ml-5"
              [checked]="isAutoRun"
              (change)="toggleAutoRun()"
            ></ui-switch> -->

            <!-- <div
              class="flex ml-5 h-9 text-gray1 text-base items-center select-none"
              >Auto Run</div
            > -->

            <!-- <button
              type="button"
              *ngIf="query?.status === queryStatusEnum.Running"
              data-cy="modelCancelButton"
              class="w-24 py-2 ml-5 text-white bg-blue3 text-base rounded font-medium focus:outline-none"
              (click)="cancel()"
              >Cancel</button
            > -->

            <button
              type="button"
              data-cy="dashboardRunButton"
              class="w-24 py-2 ml-5 text-white text-base rounded font-medium focus:outline-none"
              [ngClass]="{
                'bg-blue3': dashboard?.reports.length > 0,
                'bg-gray-400 cursor-default': dashboard?.reports.length === 0
              }"
              (click)="run()"
              [disabled]="dashboard?.reports.length === 0"
              >Run</button
            >

            <!-- <div class="relative ml-3">
              <m-query-options
                [showRunDryButton]="
                  query?.connectionType === connectionTypeEnum.BigQuery
                "
                (runDryEvent)="runDry()"
              ></m-query-options>
            </div> -->
          </div>
        </div>
      </div>

      <div class="flex flex-col flex-grow space-y-6 min-w-[2px] mt-6">
        <div
          class="bg-white rounded shadow-md w-full"
          [ngClass]="{
            'h-2/5': filtersIsExpanded
          }"
        >
          <div class="flex flex-col h-full">
            <div class="flex min-h-[80px] flex-row items-center flex-shrink-0">
              <div
                (click)="toggleFiltersPanel()"
                class="flex flex-row space-x-2 py-3 px-5 items-center cursor-pointer font-semibold text-2xl text-gray1 select-none"
              >
                <div> Filters </div>
                <m-chevron-right-icon
                  *ngIf="!filtersIsExpanded"
                ></m-chevron-right-icon>
                <m-chevron-down-icon
                  *ngIf="filtersIsExpanded"
                ></m-chevron-down-icon>
              </div>

              <m-bricks
                class="mr-5 my-3 flex flex-row items-start justify-start overflow-auto max-h-[150px] max-w-max"
                *ngIf="dashboard?.fields.length > 0"
                [extendedFilters]="extendedFilters"
              ></m-bricks>
            </div>

            <div class="flex flex-grow mx-5 mb-5 h-2" *ngIf="filtersIsExpanded">
              <div
                *ngIf="dashboard?.fields.length === 0"
                class="flex items-center justify-center text-xl h-full w-full select-none text-gray1"
                >No filters</div
              >
              <div class="flex-1 w-2 overflow-auto">
                <m-dashboard-filters
                  [dashboard]="dashboard"
                  [extendedFilters]="extendedFilters"
                ></m-dashboard-filters>
              </div>
            </div>
          </div>
        </div>

        <div #scrollable class="flex flex-row flex-grow mt-6 overflow-auto h-2">
          <ktd-grid
            *ngIf="isShowGrid === true && dashboard?.reports"
            [compactType]="compactType"
            [preventCollision]="preventCollision"
            [cols]="cols"
            [rowHeight]="rowHeight"
            [layout]="layout"
            [scrollableParent]="scrollable"
            [scrollSpeed]="scrollSpeed"
            (layoutUpdated)="onLayoutUpdated($event)"
            (resizeEnded)="onResizeEnded($event)"
            (dragStarted)="onDragStarted($event)"
            (dragEnded)="onDragEnded($event)"
          >
            <ktd-grid-item
              class="group"
              *ngFor="let item of layout; trackBy: trackByFn"
              [id]="item.id"
            >
              <div
                ktdGridDragHandle
                class="flex drag-handle justify-center items-center invisible group-hover:visible"
                ><m-drag-icon></m-drag-icon
              ></div>
              <div class="pb-6 pr-5 w-full h-full">
                <m-chart-rep
                  #chartRep
                  *ngIf="isShow === true"
                  [hidden]="isHidden"
                  [title]="item.report.title"
                  [report]="item.report"
                  [dashboard]="dashboard"
                  [mconfig]="item.report.mconfig"
                  [showBricks]="showBricks"
                ></m-chart-rep>
              </div>
              <m-resize-icon
                ktdGridResizeHandle
                class="flex resize-handle justify-center items-center invisible group-hover:visible"
              ></m-resize-icon>
            </ktd-grid-item>
          </ktd-grid>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="dashboard$ | async"></div>
<div *ngIf="extendedFilters$ | async"></div>
<div *ngIf="nav$ | async"></div>
