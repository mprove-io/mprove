<div class="bg-m1 flex h-full cursor-default flex-col">
  <div class="mx-6 flex h-2 flex-1 flex-row">
    <div class="flex min-w-[2px] flex-grow flex-col">
      <div class="flex h-2 flex-1 flex-row">
        <div class="mb-6 flex w-1/5 flex-shrink-0">
          <div class="flex w-full flex-col">
            <div class="mt-8 flex h-11 flex-row items-center">
              <div
                data-cy="dashboardsTitle"
                class="text-s1 flex select-none select-none items-center self-center text-2xl font-semibold"
                >{{ pageTitle }}
              </div>

              <div
                class="ml-5 flex flex-shrink-0 cursor-pointer flex-row items-center"
                (click)="navToDashboardsList()"
              >
                <m-view-list-icon
                  [ngClass]="{
                    'text-m500': lastUrl === pathDashboardsList,
                    'text-s400': lastUrl !== pathDashboardsList
                  }"
                ></m-view-list-icon>
              </div>

              <div class="flex flex-grow"></div>

              <div
                [tp]="templateNewDashboard"
                [tpIsEnabled]="
                  alias === restrictedUserAlias || isExplorer === false
                "
                class="ml-5"
              >
                <button
                  type="button"
                  data-cy="dashboardsAddDashboardButton"
                  class="text-m0 h-11 flex-shrink-0 select-none rounded px-5 py-2 text-base font-medium focus:outline-none"
                  [ngClass]="{
                    'bg-m600':
                      alias !== restrictedUserAlias && isExplorer === true,
                    'bg-s400 cursor-default':
                      alias === restrictedUserAlias || isExplorer === false
                  }"
                  (click)="addDashboard()"
                  [disabled]="
                    alias === restrictedUserAlias || isExplorer === false
                  "
                  >New Dashboard</button
                >

                <ng-template #templateNewDashboard>
                  <div *ngIf="alias === restrictedUserAlias"
                    >User is restricted. Sign Up at https://mprove.io to get
                    full access.</div
                  >

                  <div
                    *ngIf="
                      alias !== restrictedUserAlias && isExplorer === false
                    "
                    >Explorer role required</div
                  >
                </ng-template>
              </div>
            </div>

            <div class="bg-m0 mt-6 flex w-full flex-grow rounded shadow">
              <div class="text-s1 mt-6 flex w-full flex-col text-base">
                <div class="flex flex-1 flex-col">
                  <div class="mb-6 flex h-11 flex-row items-center">
                    <m-search-icon class="text-s1 ml-6"></m-search-icon>

                    <input
                      spellcheck="false"
                      autocomplete="off"
                      data-cy="dashboardsSearchInput"
                      class="form-input focus:border-m600 border-s400 ml-3 h-10 w-[225px] rounded"
                      placeholder="Search Dashboards"
                      [ngClass]="{
                        'bg-p200': !!word
                      }"
                      [(ngModel)]="word"
                      (ngModelChange)="searchWordChange()"
                    />

                    <div class="h-9 w-9">
                      <m-delete-icon
                        *ngIf="!!word"
                        class="text-s1 ml-3 flex h-9 w-9 flex-shrink-0 items-center justify-center rounded focus:outline-none"
                        [ngClass]="{
                          'bg-p200 hover:bg-p300 cursor-pointer': !!word
                        }"
                        (click)="resetSearch()"
                      ></m-delete-icon>
                    </div>

                    <div class="flex flex-grow"></div>

                    <button
                      *ngIf="filteredDraftsLength > 0"
                      class="ml-3 mr-10 flex flex-row items-center rounded border px-4 py-2 focus:outline-none"
                      [ngClass]="{
                        'border-s400 text-s500 hover:bg-s100':
                          filteredDraftsLength > 0,
                        'border-s300 text-s400 cursor-default':
                          filteredDraftsLength === 0
                      }"
                      [disabled]="filteredDraftsLength === 0"
                      (click)="deleteDrafts()"
                    >
                      <m-trash-icon></m-trash-icon>
                      <div class="ml-3">Drafts</div>
                    </button>
                  </div>

                  <div class="divide-s300 ml-6 mr-9 flex flex-col divide-y">
                    <div class="flex flex-row"></div>
                    <div class="flex flex-row"></div>
                  </div>

                  <div class="flex h-2 flex-grow flex-col overflow-y-auto">
                    <div *ngFor="let d of filteredDashboards; let i = index">
                      <div
                        *ngIf="filteredDraftsLength > 0 && i === 0"
                        class="text-s500 mb-4 ml-[24px] mr-[36px] mt-4 flex flex-row justify-start font-semibold"
                      >
                        Drafts
                      </div>

                      <div
                        *ngIf="i === filteredDraftsLength"
                        class="text-s500 mb-4 ml-[24px] mr-[36px] mt-4 flex flex-row justify-start font-semibold"
                      >
                        Saved Dashboards
                      </div>

                      <div
                        class="group ml-6 mr-5 flex h-11 flex-row items-center rounded pr-2 hover:cursor-pointer"
                        (click)="navToDashboard(d.dashboardId)"
                        [ngClass]="{
                          'mt-4': i === 0,
                          'mb-5': i === filteredDashboards.length - 1,
                          'hover:bg-m50':
                            d.dashboardId !== dashboard?.dashboardId
                        }"
                      >
                        <div class="ml-4 mr-3 flex h-2 items-center">
                          <div
                            *ngIf="d.dashboardId === dashboard?.dashboardId"
                            data-cy="dashboardsSelectedSymbol"
                            class="bg-m600 text-m0 h-9 w-[6px] focus:outline-none"
                          ></div>

                          <div
                            *ngIf="d.dashboardId !== dashboard?.dashboardId"
                            class="h-9 w-[6px]"
                          ></div>
                        </div>

                        <div
                          class="ml-1 truncate"
                          [ngClass]="{
                            'text-m600 font-semibold':
                              d.dashboardId === dashboard?.dashboardId,
                            'text-s1': d.dashboardId !== dashboard?.dashboardId
                          }"
                        >
                          {{ d.title | capitalize }}
                        </div>

                        <div class="flex flex-grow"></div>

                        <button
                          *ngIf="
                            dashboard?.draft === true &&
                            d.dashboardId === dashboard?.dashboardId
                          "
                          data-cy="dashboardsSaveDraftButton"
                          class="ml-3 flex h-11 items-center justify-center rounded focus:outline-none"
                          (click)="dashboardSaveAs($event)"
                        >
                          <div
                            class="hover:bg-m200 flex h-9 w-9 flex-shrink-0 flex-row items-center justify-center rounded px-2"
                          >
                            <m-save-icon class="text-s500"></m-save-icon>
                          </div>
                        </button>

                        <button
                          *ngIf="
                            dashboard?.draft === true &&
                            d.dashboardId === dashboard?.dashboardId
                          "
                          data-cy="dashboardsDeleteDraftButton"
                          class="hover:bg-m200 text-s500 ml-3 flex h-9 flex-shrink-0 items-center justify-center rounded px-2 focus:outline-none"
                          (click)="deleteDraftDashboard($event, d)"
                        >
                          <m-trash-icon></m-trash-icon>
                        </button>

                        <div
                          *ngIf="d.draft === false"
                          class="invisible ml-2 flex group-hover:visible"
                        >
                          <m-dashboard-options
                            [dashboard]="d"
                            [isHoverM]="false"
                          ></m-dashboard-options>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="divide-s300 ml-6 mr-9 flex flex-col divide-y">
                    <div class="flex flex-row"></div>
                    <div class="flex flex-row"></div>
                  </div>

                  <div class="mb-5 mr-5 mt-5 flex h-11 flex-row items-center">
                    <div class="text-s1 ml-6 select-none text-base"
                      >Timezone</div
                    >

                    <div class="ml-5 flex max-w-[260px] flex-1">
                      <form
                        class="w-full"
                        [formGroup]="timezoneForm"
                        tp="Timezone change is not allowed"
                        [tpIsEnabled]="
                          timezoneForm.controls['timezone'].disabled === true
                        "
                      >
                        <ng-select
                          #metricsTimezoneSelect
                          data-cy="metricsTimezoneSelect"
                          class="w-full text-base"
                          [items]="timezones"
                          [clearable]="false"
                          [searchable]="true"
                          [searchFn]="timezoneSearchFn"
                          (change)="timezoneChange()"
                          (keyup.esc)="
                            $event.stopImmediatePropagation();
                            metricsTimezoneSelect.blur()
                          "
                          (keyup.enter)="
                            $event.stopImmediatePropagation();
                            metricsTimezoneSelect.blur()
                          "
                          appendTo="body"
                          bindLabel="label"
                          bindValue="value"
                          formControlName="timezone"
                        >
                          <ng-template ng-label-tmp let-item="item">
                            <div class="truncate">{{ item.label }}</div>
                          </ng-template>

                          <ng-template ng-option-tmp let-item="item">
                            <div class="truncate">{{ item.label }}</div>
                          </ng-template>
                        </ng-select>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex h-full flex-1 flex-col">
          <div class="ml-6 flex h-full flex-grow">
            <div
              class="text-s1 flex h-full w-full select-none items-center justify-center text-xl"
              *ngIf="lastUrl === pathDashboards"
            >
              Select Dashboard
            </div>

            <div class="h-full w-full" *ngIf="lastUrl !== pathDashboards">
              <router-outlet></router-outlet>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="routerEvents$ | async"></div>
  <div *ngIf="dashboards$ | async"></div>
  <div *ngIf="dashboard$ | async"></div>
  <div *ngIf="nav$ | async"></div>
  <div *ngIf="member$ | async"></div>
  <div *ngIf="struct$ | async"></div>
  <div *ngIf="isExplorer$ | async"></div>
  <div *ngIf="alias$ | async"></div>

  <!-- [ngClass]="{
  'h-1/2': screenAspectRatio >= 1.5,
  'h-2/5': screenAspectRatio >= 1.2 && screenAspectRatio < 1.5,
  'h-1/3': screenAspectRatio < 1.2
}" -->
</div>
