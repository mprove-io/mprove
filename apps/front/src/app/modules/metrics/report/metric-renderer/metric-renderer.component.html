<div
  class="font-ms truncate"
  *ngIf="params.data.rowType !== rowTypeMetric"
  [ngClass]="{
    '': params.data.rowType === rowTypeHeader,
  }"
>
  <m-row-metric-label
    [name]="params.value"
    [isMetric]="false"
    [isAddPrefixRowId]="false"
    [rowId]="params.data.rowId"
  ></m-row-metric-label>
</div>

<div *ngIf="params.data.rowType === rowTypeMetric" class="font-ms">
  <div class="flex flex-col">
    <m-row-metric-label
      [name]="params.value"
      [isMetric]="true"
      [isAddPrefixRowId]="false"
      [rowId]="params.data.rowId"
      [showMetricsModelName]="showMetricsModelName"
      [showMetricsTimeFieldName]="showMetricsTimeFieldName"
      [partNodeLabel]="params.data.partNodeLabel"
      [partFieldLabel]="params.data.partFieldLabel"
      [timeNodeLabel]="params.data.timeNodeLabel"
      [timeFieldLabel]="params.data.timeFieldLabel"
      [topLabel]="params.data.topLabel"
      class="flex"
    ></m-row-metric-label>

    <div
      class="flex flex-row"
      *ngIf="
        params.data.rowType === rowTypeMetric &&
        metric.type === metricTypeModel &&
        (showParameters === true ||
          params.data.isParamsJsonValid === false ||
          params.data.isParamsSchemaValid === false)
      "
    >
      <div
        *ngIf="params.data.isRepParametersHaveError === true"
        class="text-red1 mr-5 mt-1 flex h-8 w-8 flex-shrink-0"
        tp="Parameters have an error"
        [tpIsEnabled]="
          params.data.isParamsJsonValid === false ||
          params.data.isParamsSchemaValid === false
        "
      >
        <m-exclamation-icon
          *ngIf="
            params.data.isParamsJsonValid === false ||
            params.data.isParamsSchemaValid === false
          "
        ></m-exclamation-icon>
      </div>

      <div class="truncate">
        <div class="flex flex-shrink-0">
          <m-bricks
            class="flex max-w-max flex-shrink-0 flex-row items-end justify-start overflow-auto"
            [extendedFilters]="parametersFilters"
            [isKeepBackgroundColor]="true"
            [listen]="listen"
            [formulas]="formulas"
            [parametersJson]="params.data.parametersJson"
            [showJson]="showJson"
            [onlyJson]="false"
            [jsonMaxHeight]="
              (params.data?.parametersJson || []).length > 0
                ? params.data?.finalRowHeight - 16
                : params.data?.finalRowHeight - 8
            "
          ></m-bricks>
        </div>
      </div>
    </div>

    <div
      class="flex flex-row truncate"
      *ngIf="
        params.data.rowType === rowTypeMetric && metric.type !== metricTypeModel
      "
    >
      {{ params.data.strParameters | capitalize }}
    </div>
  </div>
</div>

<div *ngIf="uiQuery$ | async"></div>
