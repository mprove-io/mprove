<div class="flex h-full w-full flex-col">
  <!-- Messages area (chat view) -->
  <m-session-messages
    class="flex h-2 w-full flex-grow flex-col overflow-y-auto"
    *ngIf="!debugMode && showSessionMessages && !isSessionSwitching"
    [turns]="turns"
    [session]="session"
    [isActivating]="isActivating"
    [isWaitingForResponse]="isWaitingForResponse"
    [isSessionError]="isSessionError"
    [scrollTrigger]="scrollTrigger"
    (permissionResponse)="respondToPermission($event)"
    (questionResponse)="respondToQuestion($event)"
    (questionReject)="rejectQuestion($event)"
  ></m-session-messages>

  <!-- Debug events view -->
  <div
    *ngIf="debugMode"
    class="mb-6 mt-6 flex h-11 flex-shrink-0 flex-row items-center"
  >
    <div class="flex flex-1"></div>

    <button
      type="button"
      class="text-s500 hover:bg-s100 flex h-9 w-9 flex-shrink-0 items-center justify-center rounded focus:outline-none"
      (click)="toggleAllEvents()"
    >
      <m-unfold-more-icon *ngIf="!allEventsExpanded"></m-unfold-more-icon>
      <m-unfold-less-icon *ngIf="allEventsExpanded"></m-unfold-less-icon>
    </button>

    <div class="ml-5 mr-6 flex-shrink-0">
      <button
        type="button"
        class="border-s400 text-s500 hover:bg-s100 flex select-none flex-row items-center rounded border p-4 py-2 focus:outline-none"
        (click)="copyEventsJson()"
      >
        <div>Copy JSON</div>
      </button>
    </div>
  </div>

  <div *ngIf="debugMode" class="divide-s300 ml-6 mr-6 flex flex-col divide-y">
    <div class="flex flex-row"></div>
    <div class="flex flex-row"></div>
  </div>

  <div *ngIf="debugMode" class="thin-scrollbar flex-grow overflow-y-auto">
    <m-session-debug-events
      [events]="events"
      [expandedEvents]="debugExpandedEvents"
      (expandedEventsChange)="debugExpandedEvents = $event"
    ></m-session-debug-events>
  </div>

  <!-- Input area (pinned to bottom) -->
  <div class="flex-shrink-0 px-6 pb-8 pt-[6px]">
    <div class="mx-auto flex max-w-[860px] items-start">
      <div class="w-5 flex-shrink-0 pt-[28px]">
        <div
          *ngIf="isWaitingForResponse"
          class="h-2.5 w-2.5 animate-pulse rounded-full bg-amber-300"
        ></div>
      </div>
      <div class="min-w-0 flex-1">
        <m-session-input
          [(model)]="model"
          [(agent)]="agent"
          [(variant)]="variant"
          [disabled]="isActivating"
          [showSelects]="messages.length > 0"
          [sessionId]="session?.sessionId"
          (send)="sendFollowUp($event)"
        ></m-session-input>
      </div>
      <div class="w-5 flex-shrink-0"></div>
    </div>
  </div>
</div>
<div *ngIf="sessionAndData$ | async"></div>
<div *ngIf="debugEvents$ | async"></div>
<div *ngIf="debugMode$ | async"></div>
<div *ngIf="showSessionMessages$ | async"></div>
