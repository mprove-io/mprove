<div *ngIf="!providerHasApiKey" class="mb-2 text-center text-base text-red-500"
  >This provider requires an API key (see Project Settings)</div
>

<div
  class="overflow-hidden rounded-3xl border-[1.5px]"
  [ngClass]="{
    'border-s300 focus-within:border-s500': !effectiveDisabled,
    'border-s200 bg-s100 opacity-60': effectiveDisabled
  }"
>
  <div
    [ngClass]="{
      'thin-scrollbar mr-3 max-h-[400px] overflow-y-auto': scrollableInput
    }"
  >
    <div class="flex w-full flex-row items-end pl-5 pr-2">
      <textarea
        class="text-s1 min-w-0 flex-1 resize-none overflow-y-hidden bg-transparent py-4 text-lg leading-relaxed placeholder-gray-400 [field-sizing:content] focus:outline-none"
        placeholder="Ask anything..."
        [(ngModel)]="messageText"
        (keydown)="onKeyDown($event)"
        [disabled]="effectiveDisabled"
        rows="1"
      ></textarea>

      <button
        class="sticky bottom-2 mb-2 ml-3 flex h-11 w-11 flex-shrink-0 items-center justify-center rounded-full focus:outline-none"
        [ngClass]="{
          'bg-m600 cursor-pointer': messageText.trim() && !effectiveDisabled,
          'bg-s300 cursor-default': !messageText.trim() || effectiveDisabled
        }"
        (click)="onSend()"
        [disabled]="!messageText.trim() || effectiveDisabled"
      >
        <m-arrow-up-icon class="text-white"></m-arrow-up-icon>
      </button>
    </div>
  </div>
</div>

<div
  *ngIf="showSelects"
  class="mt-4 flex flex-row items-center justify-center space-x-3"
>
  <ng-select
    class="session-agents-select w-[140px] select-none text-sm"
    [items]="agents"
    [clearable]="false"
    [searchable]="true"
    [searchFn]="agentsSearchFn"
    [(ngModel)]="agent"
    (ngModelChange)="onAgentSelect()"
    [disabled]="disabled"
    appendTo="body"
    placeholder="Agent"
  ></ng-select>

  <ng-select
    class="session-models-select w-[320px] select-none text-sm"
    [items]="models"
    bindLabel="label"
    bindValue="value"
    [clearable]="false"
    [searchable]="true"
    [searchFn]="modelsSearchFn"
    [loading]="modelsLoading"
    [(ngModel)]="model"
    (ngModelChange)="onModelSelect()"
    (open)="openModelSelect()"
    [disabled]="disabled"
    appendTo="body"
    placeholder="Model"
  >
    <ng-template ng-label-tmp let-item="item">
      <div class="ml-1 truncate">
        <span>{{ item.modelId }}</span>
        <span *ngIf="item.providerName" class="text-s400 ml-3 mr-2">{{
          item.providerName
        }}</span>
      </div>
    </ng-template>

    <ng-template ng-option-tmp let-item="item">
      <div class="ml-1 truncate">
        <span>{{ item.modelId }}</span>
        <span *ngIf="item.providerName" class="text-s400 ml-3 mr-2">{{
          item.providerName
        }}</span>
      </div>
    </ng-template>
  </ng-select>

  <ng-select
    class="session-variants-select w-[140px] select-none text-sm"
    [items]="variants"
    [clearable]="false"
    [searchable]="true"
    [searchFn]="variantsSearchFn"
    [(ngModel)]="variant"
    (ngModelChange)="onVariantSelect()"
    [disabled]="disabled"
    appendTo="body"
    placeholder="Thinking"
  ></ng-select>
</div>
