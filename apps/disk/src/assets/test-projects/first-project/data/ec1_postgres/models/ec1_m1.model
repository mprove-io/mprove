model: ec1_m1
label: Ecommerce 1 (PostgreSQL)
connection: c1_postgres

joins:
- from_view: ec1_order_items
  as: order_items
  
- join_view: ec1_orders
  as: orders
  sql_on: ${order_items.order_id} = ${orders.order_id}
  relationship: many_to_one
  
- join_view: ec1_users
  as: users
  sql_on: ${orders.user_id} = ${users.user_id}
  relationship: many_to_one
  
- join_view: ec1_user_order_facts
  as: user_order_facts
  sql_on: ${users.user_id} = ${user_order_facts.user_id}
  relationship: one_to_one
  
- join_view: ec1_inventory_items
  as: inventory_items
  sql_on: ${order_items.inventory_item_id} = ${inventory_items.inventory_item_id}
  relationship: many_to_one
  
- join_view: ec1_products
  as: products
  sql_on: ${inventory_items.product_id} = ${products.product_id}
  relationship: many_to_one
  
- join_view: ec1_distribution_centers
  as: distribution_centers
  sql_on: ${inventory_items.distribution_center_id} = ${distribution_centers.distribution_center_id}
  relationship: many_to_one

build_metrics:
- time: orders.created

fields:
- calculation: total_profit
  sql: ${order_items.total_sale_price} - ${inventory_items.total_actual_cost}
  format_number: '$,.0f'

 